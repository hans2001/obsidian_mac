2025-05-03 15:09

Link: https://leetcode.com/problems/range-sum-query-2d-immutable/description/

Problem: 
Given a 2D matrix `matrix`, handle multiple queries of the following type:

- Calculate the **sum** of the elements of `matrix` inside the rectangle defined by its **upper left corner** `(row1, col1)` and **lower right corner** `(row2, col2)`.

Implement the `NumMatrix` class:

- `NumMatrix(int[][] matrix)` Initializes the object with the integer matrix `matrix`.
- `int sumRegion(int row1, int col1, int row2, int col2)` Returns the **sum**of the elements of `matrix` inside the rectangle defined by its **upper left corner** `(row1, col1)` and **lower right corner** `(row2, col2)`.

You must design an algorithm where `sumRegion` works on `O(1)` time complexity.

Intuition:
understand the principle of inclusion and exclusion! reference the below consideration section! 

Solution:
```python
class NumMatrix:
	def __init__(self, matrix: List[List[int]]):
		rows = len (matrix)
		cols = len (matrix[0])
		self.pre = [[0] * cols for _ in range (rows)]
		for i in range( rows ) :
			for j in range( cols ) :
				row_sm = self.pre[ i - 1 ][ j ] if i > 0 else 0
				col_sm = self.pre[ i ][ j - 1 ] if j > 0 else 0
				over_sm = self.pre[ i - 1 ][ j - 1 ] if j > 0 and i > 0 else 0
				self.pre[i][j] = matrix[ i ][ j ] + row_sm + col_sm - over_sm
		return

	def sumRegion(self, row1: int, col1: int, row2: int, col2: int) -> int:
		ans = self. pre[ row2 ][ col2 ]
		if row1 > 0 :
			ans -= self.pre[row1-1][col2]
		if col1 > 0:
			ans -= self.pre[row2][col1 - 1]
		if row1 > 0 and col1 > 0:
			ans += self.pre[ row1 - 1 ][ col1 - 1 ]
		return ans
```

Complexity:
Time:
O(1) time per query
O(mn) time pre computation

Space:
O(mn) space to store the prefix sums! 

Tags: #prefix_sum 

RL: 

Considerations:
principle of inclusion - exclusion to calculate Sum(ABCD)
Sum(ABCD)=Sum(OD)−Sum(OB)−Sum(OC)+Sum(OA)

![Sum OD](https://leetcode.com/static/images/courses/sum_od.png)  
Sum(OD) is the cumulative region sum with respect tor the origin

![Sum OB](https://leetcode.com/static/images/courses/sum_ob.png)  
Sum(OB) is the cumulative region sum on top of the rectangle.

![Sum OC](https://leetcode.com/static/images/courses/sum_oc.png)  
Sum(OC) is the cumulative region sum to the left of the rectangle.

![Sum OA](https://leetcode.com/static/images/courses/sum_oa.png)  
Sum(OA) is the cumulative region sum to the top left corner of the rectangle.

we use sumOD to minus sum OC and SUM OB, in this case, Sum(OA) is include in both Sum(OC) and Sum(OB), so we need to add it back one time to obtain the sum in the square! 

